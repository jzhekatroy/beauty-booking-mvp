#!/bin/bash

echo "๐ซ ะัะธะฝัะดะธัะตะปัะฝะพะต ะพัะฒะพะฑะพะถะดะตะฝะธะต ะฟะพััะฐ 3000..."

# ะะพะบะฐะทัะฒะฐะตะผ ััะพ ัะตะนัะฐั ะฒะธัะธั ะฝะฐ ะฟะพััั 3000
echo "๐ ะขะตะบััะธะต ะฟัะพัะตััั ะฝะฐ ะฟะพััั 3000:"
netstat -punta | grep 3000 || echo "ะะพัั ัะฒะพะฑะพะดะตะฝ"

# ะฃะฑะธะฒะฐะตะผ next-server (ะพัะฝะพะฒะฝะฐั ะฟัะพะฑะปะตะผะฐ!)
echo "๐ฏ ะฃะฑะธะฒะฐะตะผ next-server ะฟัะพัะตััั..."
sudo pkill -9 -f "next-server" || true

# ะฃะฑะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั npm/node
echo "๐ ะฃะฑะธะฒะฐะตะผ ะฒัะต Node.js ะฟัะพัะตััั..."
sudo pkill -9 -f "npm" || true
sudo pkill -9 -f "node" || true

# ะัะธะฝัะดะธัะตะปัะฝะพ ะพัะฒะพะฑะพะถะดะฐะตะผ ะฟะพัั 3000
echo "๐ ะัะฒะพะฑะพะถะดะฐะตะผ ะฟะพัั 3000..."
sudo fuser -9 -k 3000/tcp || true

# ะฃะฑะธะฒะฐะตะผ ะฟะพ PID ะฒัะต ััะพ ะฝะฐ ะฟะพััั 3000
PIDS=$(sudo lsof -t -i:3000 2>/dev/null || true)
if [ ! -z "$PIDS" ]; then
    echo "๐ฏ ะฃะฑะธะฒะฐะตะผ ัะตัะตะท lsof: $PIDS"
    sudo kill -9 $PIDS || true
fi

# ะฃะฑะธะฒะฐะตะผ ัะตัะตะท netstat (ะบะฐะบ ะฒ ะฟัะธะผะตัะต ะฟะพะปัะทะพะฒะฐัะตะปั)
NETSTAT_PIDS=$(netstat -punta | grep ':3000' | awk '{print $7}' | cut -d'/' -f1 | grep -v '^-$' || true)
if [ ! -z "$NETSTAT_PIDS" ]; then
    echo "๐ซ ะฃะฑะธะฒะฐะตะผ ัะตัะตะท netstat: $NETSTAT_PIDS"
    echo "$NETSTAT_PIDS" | xargs -r sudo kill -9 || true
fi

sleep 2

# ะัะพะฒะตััะตะผ ัะตะทัะปััะฐั
echo "โ ะัะพะฒะตััะตะผ ัะตะทัะปััะฐั:"
if netstat -punta | grep 3000 > /dev/null 2>&1; then
    echo "โ ะะพัั 3000 ะฒัะต ะตัะต ะทะฐะฝัั:"
    netstat -punta | grep 3000
else
    echo "โ ะะพัั 3000 ัะฒะพะฑะพะดะตะฝ!"
fi

echo "๐ ะะพัะพะฒะพ!"
exit 0