#!/bin/bash

echo "üîô –û—Ç–∫–∞—Ç Beauty Booking"
echo "====================="

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
echo "üì¶ –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏:"
git tag -l --sort=-version:refname | head -10

echo
read -p "üîÑ –ö –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è: " VERSION

# –î–æ–±–∞–≤–ª—è–µ–º v –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
if [[ ! $VERSION =~ ^v ]]; then
    VERSION="v$VERSION"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤–µ—Ä—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if ! git tag -l | grep -q "^$VERSION$"; then
    echo "‚ùå –í–µ—Ä—Å–∏—è $VERSION –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    exit 1
fi

echo "‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ! –í—Å–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!"
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ç–∫–∞—Ç –∫ $VERSION? (y/N): " CONFIRM

if [[ $CONFIRM != "y" && $CONFIRM != "Y" ]]; then
    echo "‚ùå –û—Ç–∫–∞—Ç –æ—Ç–º–µ–Ω–µ–Ω"
    exit 1
fi

echo
echo "üîÑ –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –∫ –≤–µ—Ä—Å–∏–∏ $VERSION..."
git checkout $VERSION

echo "üî® –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
npm run build

if [ $? -eq 0 ]; then
    echo
    echo "‚úÖ –û—Ç–∫–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!"
    echo "üì¶ –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $VERSION"
    echo "üîó –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏: git checkout main"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞!"
    exit 1
fi