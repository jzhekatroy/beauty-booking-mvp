#!/bin/bash

echo "๐ ะะตะฟะปะพะน Beauty Booking"
echo "======================="

# ะัะพะฒะตััะตะผ ะตััั ะปะธ ะธะทะผะตะฝะตะฝะธั
if [[ -z $(git status --porcelain) ]]; then
    echo "โ ะะตั ะธะทะผะตะฝะตะฝะธะน ะดะปั ะดะตะฟะปะพั"
    exit 1
fi

# ะะพะบะฐะทัะฒะฐะตะผ ะธะทะผะตะฝะตะฝะธั
echo "๐ ะะทะผะตะฝะตะฝะธั:"
git diff --name-only

# ะะฐะฟัะฐัะธะฒะฐะตะผ ะฒะตััะธั
echo
read -p "๐ท๏ธ ะะพะฒะฐั ะฒะตััะธั (ะฝะฐะฟัะธะผะตั v1.2): " VERSION
read -p "๐ ะงัะพ ะธะทะผะตะฝะธะปะพัั: " DESCRIPTION

# ะะพะฑะฐะฒะปัะตะผ v ะตัะปะธ ะฝะต ัะบะฐะทะฐะฝ
if [[ ! $VERSION =~ ^v ]]; then
    VERSION="v$VERSION"
fi

echo
echo "๐พ ะกะพััะฐะฝัะตะผ ะธะทะผะตะฝะตะฝะธั..."
git add .
git commit -m "$VERSION - $DESCRIPTION"

echo "๐ท๏ธ ะกะพะทะดะฐะตะผ ัะตะณ ะฒะตััะธะธ..."
git tag $VERSION

echo "๐จ ะกะพะฑะธัะฐะตะผ ะฟัะธะปะพะถะตะฝะธะต..."
npm run build

if [ $? -eq 0 ]; then
    echo
    echo "๐ ะะตะฟะปะพะน ะทะฐะฒะตััะตะฝ!"
    echo "๐ฆ ะะตััะธั: $VERSION"
    echo "๐ ะะฟะธัะฐะฝะธะต: $DESCRIPTION"
    echo "๐ ะะทะผะตะฝะตะฝะธั ัะพััะฐะฝะตะฝั ะฒ Git"
else
    echo "โ ะัะธะฑะบะฐ ัะฑะพัะบะธ! ะัะบะฐััะฒะฐะตะผ..."
    git reset --hard HEAD~1
    git tag -d $VERSION
    exit 1
fi